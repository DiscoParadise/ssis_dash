//     keymaster.js
//     (c) 2011-2013 Thomas Fuchs
//     keymaster.js may be freely distributed under the MIT license.
(function(f){function p(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function z(a){var b,c,d,f,r,v;b=a.keyCode;-1==p(n,b)&&n.push(b);if(93==b||224==b)b=91;if(b in e)for(d in e[b]=!0,l)l[d]==b&&(m[d]=!0);else{for(g in e)e[g]=a[A[g]];if(m.filter.call(this,a)&&b in h)for(v=t(),f=0;f<h[b].length;f++)if(c=h[b][f],c.scope==v||"all"==c.scope){r=0<c.mods.length;for(d in e)if(!e[d]&&-1<p(c.mods,+d)||e[d]&&-1==p(c.mods,+d))r=!1;(0!=c.mods.length||e[16]||e[18]||e[17]||e[91])&&!r||!1!==c.method(a,
c)||(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&(a.cancelBubble=!0))}}}function m(a,b,c){var d,f;d=w(a);void 0===c&&(c=b,b="all");for(var e=0;e<d.length;e++)f=[],a=d[e].split("+"),1<a.length&&(f=x(a),a=[a[a.length-1]]),a=a[0],a=q[a]||a.toUpperCase().charCodeAt(0),a in h||(h[a]=[]),h[a].push({shortcut:d[e],scope:b,method:c,key:d[e],mods:f})}function t(){return y||"all"}function w(a){a=a.replace(/\s/g,"");a=a.split(",");""==a[a.length-
1]&&(a[a.length-2]+=",");return a}function x(a){a=a.slice(0,a.length-1);for(var b=0;b<a.length;b++)a[b]=l[a[b]];return a}function u(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})}var g,h={},e={16:!1,18:!1,17:!1,91:!1},y="all",l={"\u21e7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,command:91},q={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,
down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},n=[];for(g=1;20>g;g++)q["f"+g]=111+g;var A={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(g in l)m[g]=!1;u(document,"keydown",function(a){z(a)});u(document,"keyup",function(a){a=a.keyCode;var b,c=p(n,a);0<=c&&n.splice(c,1);if(93==a||224==a)a=91;if(a in e)for(b in e[a]=!1,l)l[b]==a&&(m[b]=!1)});u(window,"focus",function(){for(g in e)e[g]=
!1;for(g in l)m[g]=!1});var B=f.key;f.key=m;f.key.setScope=function(a){y=a||"all"};f.key.getScope=t;f.key.deleteScope=function(a){var b,c,d;for(b in h)for(c=h[b],d=0;d<c.length;)c[d].scope===a?c.splice(d,1):d++};f.key.filter=function(a){a=(a.target||a.srcElement).tagName;return!("INPUT"==a||"SELECT"==a||"TEXTAREA"==a)};f.key.isPressed=function(a){"string"==typeof a&&(a=q[a]||a.toUpperCase().charCodeAt(0));return-1!=p(n,a)};f.key.getPressedKeyCodes=function(){return n.slice(0)};f.key.noConflict=function(){var a=
f.key;f.key=B;return a};f.key.unbind=function(a,b){var c,d,f=[],e,g;c=w(a);for(e=0;e<c.length;e++){d=c[e].split("+");1<d.length&&(f=x(d));a=d[d.length-1];a=q[a]||a.toUpperCase().charCodeAt(0);void 0===b&&(b=t());if(!h[a])break;for(d=0;d<h[a].length;d++){g=h[a][d];var k;if(k=g.scope===b)a:if(g=g.mods,g.length!=f.length)k=!1;else{for(k=0;k<g.length;k++)if(g[k]!==f[k]){k=!1;break a}k=!0}k&&(h[a][d]={})}}};"undefined"!==typeof module&&(module.exports=m)})(this);